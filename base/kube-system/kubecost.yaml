# https://artifacthub.io/packages/helm/bitnami/external-dns
---
apiVersion: 'helm.fluxcd.io/v1'
kind: 'HelmRelease'
metadata:
  annotations:
    filter.fluxcd.io/chart-image: 'semver:~0'
    fluxcd.io/automated: 'true'
  name: cost-analyzer
  namespace: 'kube-system'
spec:
  chart:
    name: 'cost-analyzer'
    repository: 'https://kubecost.github.io/cost-analyzer/'
    version: '1.71.0'
  releaseName: 'cost-analyzer'
Values:
  ingress:
    enabled: true
    annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/group.name: gvm
    alb.ingress.kubernetes.io/subnets: subnet-03d40d519b4752651,subnet-062082934584787e8
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-1:594348282413:certificate/35e3763c-bd1a-495c-b70d-509e5a10a7fc,arn:aws:acm:ap-northeast-1:594348282413:certificate/11518b70-540b-4112-8c13-003b54869008,arn:aws:acm:ap-northeast-1:594348282413:certificate/92befd99-d6c2-42ef-955d-6b719248cf3e
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'
    alb.ingress.kubernetes.io/inbound-cidrs: 0.0.0.0/0
    # this will update route53
    external-dns.alpha.kubernetes.io/hostname: cost.cwgv.org.tw
    alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=true,access_logs.s3.bucket=cwgv-log,access_logs.s3.prefix=eks-elb
    alb.ingress.kubernetes.io/load-balancer-attributes: deletion_protection.enabled=true
      # kubernetes.io/tls-acme: "true"
    paths: ["/"] # There's no need to route specifically to the pods-- we have an nginx deployed that handles routing
    hosts:
      - cost.cwgv.org.tw

